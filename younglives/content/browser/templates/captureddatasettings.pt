<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<metal:block fill-slot="column_two_slot" />
    
<metal:header fill-slot="header">
    <div id="younglives-view-modifier"><!-- --></div>
</metal:header>

<metal:javascript fill-slot="javascript_head_slot">
    <script type="text/javascript">
        jq(document).ready(function()
        {
            jq("input.checkall").click(function()
            {
                parent_table = jq(this).closest('table.listing')
                var checked_status = this.checked;
                jq("td input:checkbox", parent_table).each(function()
                {
                    this.checked = checked_status;
                });
            });
         });
    </script>
</metal:javascript>

<body>

<div metal:fill-slot="main">

    <tal:records define="records view/records;
        year request/form/year|view/curr_year;
        month request/form/month|view/curr_month">

        <dl tal:define="status view/info_status"
            tal:condition="status"
            class="portalMessage info">
            <dt>Info</dt>
            <dd tal:content="status" />
        </dl>
        
        <dl tal:define="status view/error_status"
            tal:condition="status"
            class="portalMessage error">
            <dt>Error</dt>
            <dd tal:content="status" />
        </dl>
        

        <h2>Captured data management</h2>
        <p class="discreet">You can remove or export captured data.</p>
        <p><a href="#" title="Export records" class="captured-data-export-icon"
              tal:attributes="href string:${context/absolute_url}/export-captured-data?month=$month&amp;year=$year">
              Export records from <span tal:replace="string:$month/$year" /> to CSV file</a>
        </p>
        
        <div>
            <form action="."
                  tal:attributes="action request/URL;"
                  method="post">
                  
                <p>
                    <select name="month">
                        <option tal:repeat="option python:range(1,13)" 
                                tal:attributes="value option;
                                                selected python:str(month)==str(option)"
                                tal:content="python:'%02d' % option">month</option>
                    </select>
                    
                    <select name="year">
                        <option tal:repeat="option python:range(2010,view.curr_year()+1)" 
                                tal:attributes="value option;
                                                selected python:str(year)==str(option)"
                                tal:content="option">year</option>
                    </select>
                    
                    <input type="submit" class="context" value="Refresh" name="refresh" />
                </p>

                <div tal:condition="records"
                     class="field">
                
                    <table class="listing" width="100%">
                        <tr>
                            <th><input type="checkbox" class="checkall"/></th>
                            <th>Date</th>
                            <th>Country</th>
                            <th>Job Title</th>
                            <th>Organization</th>
                        </tr>
                        <tr tal:repeat="record records"
                            tal:attributes="class python:repeat['record'].even() and 'odd' or 'even'">
                            <td><input type="checkbox" name="records:list" 
                                       tal:attributes="value record/id" /></td>
                            <td tal:content="python:context.toLocalizedTime(float(record['id']))" />
                            <td tal:content="record/country" />
                            <td tal:content="record/jobtitle" />
                            <td tal:content="record/organization" />
                        </tr>
                    </table>
        
                    <div class="visualClear"><!-- --></div>
                    
                    <div id="actionsView" class="formControls">
                        <span class="actionButtons">
                            <input type="submit" class="context" value="Remove selected" name="remove" />
                        </span>
                    </div>
                       
                </div>
                
                <p tal:condition="not:records">No records found.</p>
                
                <input type="hidden" name="form.submitted" value="1" />
                <input tal:replace="structure context/@@authenticator/authenticator" />
                
            </form>
        </div>
    
    </tal:records>

</div>

</body>
</html>